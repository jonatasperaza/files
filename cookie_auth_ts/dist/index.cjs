"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("vue");function p(e,u,s){e.defaults.withCredentials=!0,e.defaults.baseURL=u.baseURL;let o=!1,t=[];const c=(n,l)=>{t.forEach(({resolve:i,reject:r})=>n?i():r(l)),t=[]};e.interceptors.response.use(n=>n,async n=>{var i;const l=n.config;if(((i=n.response)==null?void 0:i.status)!==401||l._retried)return Promise.reject(n);if(o)return new Promise((r,g)=>{t.push({resolve:()=>r(e(l)),reject:g})});l._retried=!0,o=!0;try{return await e.post(u.refreshEndpoint),c(!0),e(l)}catch(r){return c(!1,r),s(),Promise.reject(r)}finally{o=!1}})}const f=d.ref(null),a=d.ref(!1),h=d.ref(null),v=d.computed(()=>f.value!==null);function w(e,u){async function s(n){var l,i;a.value=!0,h.value=null;try{await e.post(u.loginEndpoint,n),await t()}catch(r){const g=((i=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:i.detail)??"Erro ao realizar login.";throw h.value=g,r}finally{a.value=!1}}async function o(){a.value=!0,h.value=null;try{await e.post(u.logoutEndpoint)}catch{}finally{f.value=null,a.value=!1}}async function t(){a.value=!0;try{const n=await e.get(u.userEndpoint);f.value=n.data}catch{f.value=null}finally{a.value=!1}}async function c(){await e.post(u.refreshEndpoint)}return{user:f,isAuthenticated:v,isLoading:a,error:h,login:s,logout:o,fetchUser:t,refresh:c}}const y={loginEndpoint:"/auth/login/",logoutEndpoint:"/auth/logout/",refreshEndpoint:"/auth/refresh/",userEndpoint:"/auth/me/",loginRoute:"/login"};function E(e,u){const s={...y,...u};return{install(o){let t=null;p(e,s,()=>{t?t.push(s.loginRoute):window.location.href=s.loginRoute}),o.provide("cookieJwtAxios",e),o.provide("cookieJwtOptions",s),o.mixin({beforeCreate(){!t&&this.$router&&(t=this.$router)}})}}}exports.createCookieJwt=E;exports.useAuth=w;
